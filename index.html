<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta property="og:title" content="Hari Santri Nasional 2025">
  <meta property="og:description" content="Ayo rayakan momen penuh berkah ini bersama MDT Al-Ikhwan Margasari. Klik untuk membuat twibbon.">
  <meta property="og:image" content="https://raw.githubusercontent.com/mdt-alikhwann/hari-santri/refs/heads/main/hsn2025.png">
  <meta property="og:type" content="website">
  <title>Twibbon Hari Santri</title>

  <!-- Bootstrap & Fonts -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Lora:wght@400;600&family=Merriweather:wght@400;700&family=Alan+Sans:wght@300..900&display=swap" as="style">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Lora:wght@400;600&family=Merriweather:wght@400;700&family=Alan+Sans:wght@300..900&display=swap">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

  <style>
    body {
  font-family: 'Alan Sans', sans-serif;
  margin: 0 auto;
  min-height: 100vh;
  color: #333;
  box-sizing: border-box;
  overflow-x: hidden;
  background: linear-gradient(135deg, #e6f7f1 0%, #d0f0ff 50%, #fffbe6 100%);
}

    h3 {
      color: #004d40;
      letter-spacing: 0.5px;
    }

    #canvas {
      width: 100%;
      border: 2px dashed #a7b2b5;
      border-radius: 16px;
      background-color: #fff;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
      transition: all 0.3s ease;
    }

    #canvas:hover {
      border-color: #198754;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
    }

    input[type="file"] {
      cursor: pointer;
      border: 1px solid #ccc !important;
      transition: 0.2s ease;
      font-size: 13px;
    }

    input[type="file"]:hover {
      border-color: #198754 !important;
      background-color: #f1fdf5 !important;
    }

    .btn {
      border-radius: 50px;
      padding: 0.6rem 1.4rem;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .btn-outline-primary:hover {
      background-color: #0d6efd;
      color: #fff;
      box-shadow: 0 4px 12px rgba(13, 110, 253, 0.3);
    }

    .btn-outline-success:hover {
      background-color: #198754;
      color: #fff;
      box-shadow: 0 4px 12px rgba(25, 135, 84, 0.3);
    }

    .btn-outline-warning:hover {
      background-color: #ffc107;
      color: #fff;
      box-shadow: 0 4px 12px rgba(255, 193, 7, 0.3);
    }

    footer small {
      font-size: 10px;
    }

    .fade-up {
      opacity: 0;
      transform: translateY(20px);
      animation: fadeUp 0.8s ease forwards;
    }

    @keyframes fadeUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @media (max-width: 576px) {
      h3 {
        font-size: 1.3rem;
      }
      .btn {
        font-size: 0.9rem;
        padding: 0.5rem 1.1rem;
      }
      #canvas {
        border-width: 1.5px;
      }
    }
    .text-gradient {
  background: linear-gradient(25deg, darkgreen, #00b846);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  text-fill-color: transparent;
}
  </style>
</head>

<body class="bg-success-subtle">
  <div class="container pt-5 px-3 text-center">
    <h2 class="mb-1 fw-bold text-gradient">Hari Santri Nasional <span class="year"></span></h2>
    <div class="text-muted small">MDT Al-Ikhwan Margasari Sidareja</div>

    <p class="mt-3 small text-muted mb-1">Upload selfie terbaikmu disini</p>
    <div class="mb-3 mt-1 w-75 mx-auto text-center">
      <input type="file" id="uploadtwb" class="form-control fs-sm" accept="image/*">
    </div>

    <canvas class="fade-up" id="canvas" width="1620" height="1620"></canvas>

    <!-- Kontrol tambahan -->
    <div class="mt-3 d-flex gap-2 justify-content-center flex-wrap fade-up">
      <button id="zoomIn" class="btn-sm btn btn-outline-success"><i class="bi bi-zoom-in"></i></button>
      <button id="zoomOut" class="btn-sm btn btn-outline-success"><i class="bi bi-zoom-out"></i></button>
      <button id="rotate" class="btn-sm btn btn-outline-dark"><i class="bi bi-arrow-clockwise"></i></button>
    </div>

    <!-- Filter foto -->
    <div class="mt-2 w-75 mx-auto text-center">
      <label class="form-label small">Kecerahan</label>
      <input type="range" id="brightness" min="0.5" max="1.5" step="0.001" value="1" class="form-range">
      <label class="form-label small">Kontras</label>
      <input type="range" id="contrast" min="0.5" max="1.5" step="0.001" value="1" class="form-range">
    </div>
    
      <div class="mt-3 d-flex gap-2 justify-content-center flex-wrap fade-up">
      <button id="reset" class="btn-sm btn btn-outline-secondary"><i class="bi bi-arrow-counterclockwise"></i> Reset</button>
     <button id="download" class="btn-sm btn btn-outline-primary">
        <i class="bi bi-download"></i> Download
      </button>
      <button id="share" class="btn-sm btn btn-outline-success"><i class="bi bi-share"></i> Share</button>
    </div>
  </div>

  <div class="text-center mt-5 mb-4">
    <small class="text-muted small">&copy; <span class="year"></span> MDT Al-Ikhwan</small>
  </div>

  <!-- Modal Preview -->
<div class="modal fade" id="previewModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="confirmModalLabel">Konfirmasi Download</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
      </div>
      <img id="previewImage" src="" alt="" />
      <div class="modal-body">
        Jika sudah sesuai klik tombol "OK" untuk mendowload
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
        <button type="button" id="confirmDownload" class="btn btn-primary">OK</button>
      </div>
    </div>
  </div>
</div>

  <!-- Script -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // Tahun Otomatis
    document.querySelectorAll('.year').forEach(el => el.textContent = new Date().getFullYear());

    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const uploadtwb = document.getElementById('uploadtwb');
    const downloadBtn = document.getElementById('download');
    const shareBtn = document.getElementById('share');

    const frame = new Image();
frame.src = 'hsn2025.png';
let frameReady = false;
frame.onload = () => { frameReady = true; draw(); };

let userImg = null;
let imgX = 0, imgY = 0;
let imgScale = 1;
let imgRotation = 0;
let original = {};
let brightness = 1, contrast = 1;
// Upload Foto
uploadtwb.addEventListener('change', (e) => {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = (ev) => {
    const img = new Image();
    img.onload = () => {
      userImg = img;
      imgScale = Math.max(canvas.width / img.width, canvas.height / img.height);
      imgRotation = 0;
      imgX = canvas.width / 2;
      imgY = canvas.height / 2;
      original = { imgScale, imgRotation, imgX, imgY };
      draw();

      // ðŸ”¥ Scroll otomatis ke paling bawah
      setTimeout(() => {
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
      }, 500);
    };
    img.src = ev.target.result;
  };
  reader.readAsDataURL(file);
});

    // Gambar ulang
    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      if (userImg) {
        ctx.save();
        ctx.translate(imgX, imgY);
        ctx.rotate(imgRotation);
        ctx.scale(imgScale, imgScale);
        ctx.filter = `brightness(${brightness}) contrast(${contrast})`;
        ctx.drawImage(userImg, -userImg.width / 2, -userImg.height / 2);
        ctx.restore();
      }
      if (frameReady) ctx.drawImage(frame, 0, 0, canvas.width, canvas.height);
    }

    // Zoom & Rotate Buttons
    document.getElementById('zoomIn').onclick = () => { imgScale *= 1.02; draw(); };
    document.getElementById('zoomOut').onclick = () => { imgScale /= 1.02; draw(); };
    document.getElementById('rotate').onclick = () => { imgRotation += Math.PI / 100; draw(); };
    // Tombol rotate ke kiri
const rotateLeftBtn = document.createElement('button');
rotateLeftBtn.className = 'btn-sm btn btn-outline-dark';
rotateLeftBtn.innerHTML = '<i class="bi bi-arrow-counterclockwise"></i>';
rotateLeftBtn.onclick = () => { imgRotation -= Math.PI / 100; draw(); };

// Sisipkan tombol di sebelum tombol reset
document.getElementById('rotate').before(rotateLeftBtn);

    // Reset Button
    document.getElementById('reset').onclick = () => {
      if (!userImg) return;
      imgScale = original.imgScale;
      imgRotation = original.imgRotation;
      imgX = original.imgX;
      imgY = original.imgY;
      brightness = 1;
      contrast = 1;
      document.getElementById('brightness').value = 1;
      document.getElementById('contrast').value = 1;
      draw();
    };

    // Filter Slider
    document.getElementById('brightness').oninput = (e) => { brightness = e.target.value; draw(); };
    document.getElementById('contrast').oninput = (e) => { contrast = e.target.value; draw(); };

    // Mouse & Touch untuk drag dan zoom
    let isDragging = false, startX = 0, startY = 0;
    canvas.addEventListener('mousedown', (e) => { if (userImg) { isDragging = true; startX = e.offsetX - imgX; startY = e.offsetY - imgY; }});
    canvas.addEventListener('mousemove', (e) => { if (isDragging) { imgX = e.offsetX - startX; imgY = e.offsetY - startY; draw(); }});
    canvas.addEventListener('mouseup', () => isDragging = false);
    canvas.addEventListener('mouseleave', () => isDragging = false);
    canvas.addEventListener('wheel', (e) => { if (userImg) { e.preventDefault(); imgScale *= e.deltaY < 0 ? 1.05 : 0.95; draw(); }});

    // Touch Gesture
    let lastTouchDist = null, lastTouchAngle = null, isTouchDragging = false, touchStartX = 0, touchStartY = 0;
    canvas.addEventListener('touchstart', (e) => {
      if (!userImg) return;
      if (e.touches.length === 1) {
        isTouchDragging = true;
        touchStartX = e.touches[0].clientX - imgX;
        touchStartY = e.touches[0].clientY - imgY;
      } else if (e.touches.length === 2) {
        isTouchDragging = false;
        lastTouchDist = getTouchDistance(e.touches);
        lastTouchAngle = getTouchAngle(e.touches);
      }
    });
    canvas.addEventListener('touchmove', (e) => {
      if (!userImg) return;
      e.preventDefault();
      if (e.touches.length === 1 && isTouchDragging) {
        imgX = e.touches[0].clientX - touchStartX;
        imgY = e.touches[0].clientY - touchStartY;
        draw();
      } else if (e.touches.length === 2) {
        const newDist = getTouchDistance(e.touches);
        const newAngle = getTouchAngle(e.touches);
        if (lastTouchDist) imgScale *= newDist / lastTouchDist;
        if (lastTouchAngle !== null) imgRotation += (newAngle - lastTouchAngle);
        lastTouchDist = newDist;
        lastTouchAngle = newAngle;
        draw();
      }
    });
    canvas.addEventListener('touchend', () => { lastTouchDist = null; lastTouchAngle = null; isTouchDragging = false; });

    function getTouchDistance(touches) {
      const dx = touches[0].clientX - touches[1].clientX;
      const dy = touches[0].clientY - touches[1].clientY;
      return Math.sqrt(dx * dx + dy * dy);
    }
    function getTouchAngle(touches) {
      const dx = touches[1].clientX - touches[0].clientX;
      const dy = touches[1].clientY - touches[0].clientY;
      return Math.atan2(dy, dx);
    }

    // Preview Sebelum Download
// Tombol Download Utama -> buka modal preview
downloadBtn.addEventListener('click', () => {
  const dataURL = canvas.toDataURL('image/png');
  document.getElementById('previewImage').src = dataURL;
  const previewModal = new bootstrap.Modal(document.getElementById('previewModal'));
  previewModal.show();
  
  // Tambahkan event listener ke tombol OK di modal
  const confirmBtn = document.getElementById('confirmDownload');
  confirmBtn.onclick = () => {
    // Proses download dijalankan di sini
    const link = document.createElement('a');
    link.download = 'HSN MDT AL-IKHWAN.png';
    link.href = dataURL;
    link.click();
    
    // Tutup modal setelah download
    previewModal.hide();
  };
});

    // Share Button
    shareBtn.addEventListener('click', async () => {
      const dataUrl = canvas.toDataURL('image/png');
      const blob = await (await fetch(dataUrl)).blob();
      const file = new File([blob], 'HSN MDT AL-IKHWAN.png', { type: 'image/png' });
      const shareTitle = 'Hari Santri Nasional 2025';
      const shareText = `ðŸŒ¿âœ¨ Yuk rayakan momen istimewa ini bersama MDT Al-Ikhwan Margasari! 
Saya sudah pasang overlay foto, giliran kamu sekarang`;

      if (navigator.canShare && navigator.canShare({ files: [file] })) {
        try {
          await navigator.share({ title: shareTitle, text: shareText, files: [file], url: 'https://mdt-alikhwann.github.io/hari-santri/' });
        } catch (err) {
          console.warn('Share dibatalkan:', err);
        }
      } else {
        alert('Browser tidak mendukung fitur bagikan langsung. Silakan download manual.');
      }
    });
  </script>
</body>
  </html>
