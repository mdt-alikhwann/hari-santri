<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta property="og:title" content="Hari Santri Nasional 2025">
  <meta property="og:description" content="Ayo rayakan momen penuh berkah ini bersama MDT Al-Ikhwan Margasari. Klik untuk membuat twibbon.">
  <meta property="og:image" content="https://raw.githubusercontent.com/mdt-alikhwann/hari-santri/refs/heads/main/hsn2025.png">
  <meta property="og:type" content="website">
  <title>Twibbon Hari Santri</title>

  <!-- Bootstrap & Fonts -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Lora:wght@400;600&family=Merriweather:wght@400;700&family=Alan+Sans:wght@300..900&display=swap" as="style">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Lora:wght@400;600&family=Merriweather:wght@400;700&family=Alan+Sans:wght@300..900&display=swap">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

  <style>
    body {
      font-family: 'Alan Sans', sans-serif;
      margin: 0 auto;
      min-height: 100vh;
      
      color: #333;
      box-sizing: border-box;
      overflow-x: hidden;
    }

    h3 {
      color: #004d40;
      letter-spacing: 0.5px;
    }

    p.text-muted {
      color: #6c757d !important;
    }

    /* Canvas Frame */
    #canvas {
      width: 100%;
      height: auto;
      border: 2px dashed #a7b2b5;
      border-radius: 16px;
      background-color: #fff;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
      transition: all 0.3s ease;
    }

    #canvas:hover {
      border-color: #198754;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
    }

    /* File input */
    input[type="file"] {
      cursor: pointer;
      border: 1px solid #ccc !important;
      transition: 0.2s ease;
      font-size: 13px;
    }

    input[type="file"]:hover {
      border-color: #198754 !important;
      background-color: #f1fdf5 !important;
    }

    /* Buttons */
    .btn {
      border-radius: 50px;
      padding: 0.6rem 1.4rem;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .btn-outline-primary:hover {
      background-color: #0d6efd;
      color: #fff;
      box-shadow: 0 4px 12px rgba(13, 110, 253, 0.3);
    }

    .btn-outline-success:hover {
      background-color: #198754;
      color: #fff;
      box-shadow: 0 4px 12px rgba(25, 135, 84, 0.3);
    }

    /* Footer */
    .abu {
      color: #6c757d;
    }

    footer small {
      font-size: 10px;
    }

    /* Simple fade animation */
    .fade-up {
      opacity: 0;
      transform: translateY(20px);
      animation: fadeUp 0.8s ease forwards;
    }

    @keyframes fadeUp {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Responsive */
    @media (max-width: 576px) {
      h3 {
        font-size: 1.3rem;
      }

      .btn {
        font-size: 0.9rem;
        padding: 0.5rem 1.1rem;
      }

      #canvas {
        border-width: 1.5px;
      }
    }
  </style>
</head>

<body class="bg-success-subtle">
  <div class="container pt-5 px-3 text-center">
    <h3 class="mb-1 fw-bold">Hari Santri Nasional <span class="year"></span></h3>
    <div class="text-muted small">MDT Al-Ikhwan Margasari Sidareja</div>
    <p class="mt-3 small text-muted mb-1">
      Upload selfie terbaikmu disini
    </p>
    <div class="mb-3 mt-1 w-75 mx-auto text-center ">
      <input type="file" id="uploadtwb" class="form-control fs-sm " accept="image/*">
    </div>

    <canvas class="fade-up" id="canvas" width="1620" height="1620"></canvas>

    <div class="mt-3 d-flex gap-2 justify-content-center fade-up">
      <button id="download" class="btn btn-outline-primary"><i class="bi bi-download"></i> Download</button>
      <button id="share" class="btn btn-outline-success"><i class="bi bi-share"></i> Bagikan</button>
    </div>
  </div>

  <div class="text-center mt-5 mb-4">
    <small class="abu">&copy; <span class="year"></span> MDT Al-Ikhwan</small>
  </div>

  <!-- Tahun Otomatis -->
  <script>
    const yearElements = document.querySelectorAll('.year');
    const currentYear = new Date().getFullYear();
    yearElements.forEach(el => el.textContent = currentYear);
  </script>

  <!-- Semua fungsi asli tidak diubah -->
  <script>
    //foto overlay 
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const uploadtwb = document.getElementById('uploadtwb');
    const downloadBtn = document.getElementById('download');
    const shareBtn = document.getElementById('share');

    const frame = new Image();
    frame.src = './hsn2025.png'; // pastikan path benar
    let frameReady = false;
    frame.onload = () => { frameReady = true; draw(); };

    let userImg = null;
    let imgX = 0, imgY = 0;
    let imgScale = 1;
    let imgRotation = 0;
    let original = {};

    uploadtwb.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (ev) => {
        const img = new Image();
        img.onload = () => {
          userImg = img;
          imgScale = Math.max(canvas.width / img.width, canvas.height / img.height);
          imgRotation = 0;
          imgX = canvas.width / 2;
          imgY = canvas.height / 2;
          original = { imgScale, imgRotation, imgX, imgY };
          draw();
        };
        img.src = ev.target.result;
      };
      reader.readAsDataURL(file);
    });

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      if (userImg) {
        ctx.save();
        ctx.translate(imgX, imgY);
        ctx.rotate(imgRotation);
        ctx.scale(imgScale, imgScale);
        ctx.drawImage(userImg, -userImg.width / 2, -userImg.height / 2);
        ctx.restore();
      }
      if (frameReady) {
        ctx.drawImage(frame, 0, 0, canvas.width, canvas.height);
      }
    }

    // --- DESKTOP DRAG ---
    let isDragging = false;
    let startX = 0, startY = 0;
    canvas.addEventListener('mousedown', (e) => {
      if (!userImg) return;
      isDragging = true;
      startX = e.offsetX - imgX;
      startY = e.offsetY - imgY;
    });
    canvas.addEventListener('mousemove', (e) => {
      if (isDragging) {
        imgX = e.offsetX - startX;
        imgY = e.offsetY - startY;
        draw();
      }
    });
    canvas.addEventListener('mouseup', () => isDragging = false);
    canvas.addEventListener('mouseleave', () => isDragging = false);
    canvas.addEventListener('wheel', (e) => {
      if (!userImg) return;
      e.preventDefault();
      const factor = e.deltaY < 0 ? 1.05 : 0.95;
      imgScale *= factor;
      draw();
    });

    // --- TOUCH GESTURE ---
    let lastTouchDist = null;
    let lastTouchAngle = null;
    let isTouchDragging = false;
    let touchStartX = 0, touchStartY = 0;

    canvas.addEventListener('touchstart', (e) => {
      if (!userImg) return;
      if (e.touches.length === 1) {
        isTouchDragging = true;
        touchStartX = e.touches[0].clientX - imgX;
        touchStartY = e.touches[0].clientY - imgY;
      } else if (e.touches.length === 2) {
        isTouchDragging = false;
        lastTouchDist = getTouchDistance(e.touches);
        lastTouchAngle = getTouchAngle(e.touches);
      }
    });

    canvas.addEventListener('touchmove', (e) => {
      if (!userImg) return;
      e.preventDefault();

      if (e.touches.length === 1 && isTouchDragging) {
        imgX = e.touches[0].clientX - touchStartX;
        imgY = e.touches[0].clientY - touchStartY;
        draw();
      } else if (e.touches.length === 2) {
        const newDist = getTouchDistance(e.touches);
        const newAngle = getTouchAngle(e.touches);

        if (lastTouchDist) imgScale *= newDist / lastTouchDist;
        if (lastTouchAngle !== null) imgRotation += (newAngle - lastTouchAngle);

        lastTouchDist = newDist;
        lastTouchAngle = newAngle;
        draw();
      }
    });

    canvas.addEventListener('touchend', () => {
      lastTouchDist = null;
      lastTouchAngle = null;
      isTouchDragging = false;
    });

    function getTouchDistance(touches) {
      const dx = touches[0].clientX - touches[1].clientX;
      const dy = touches[0].clientY - touches[1].clientY;
      return Math.sqrt(dx * dx + dy * dy);
    }

    function getTouchAngle(touches) {
      const dx = touches[1].clientX - touches[0].clientX;
      const dy = touches[1].clientY - touches[0].clientY;
      return Math.atan2(dy, dx);
    }

    // --- DOWNLOAD ---
    downloadBtn.addEventListener('click', () => {
      const link = document.createElement('a');
      link.download = 'HSN MDT AL-IKHWAN.png';
      link.href = canvas.toDataURL('image/png');
      link.click();
    });

    // --- BAGIKAN ---
    shareBtn.addEventListener('click', async () => {
      const dataUrl = canvas.toDataURL('image/png');
      const blob = await (await fetch(dataUrl)).blob();
      const file = new File([blob], 'HSN MDT AL-IKHWAN.png', { type: 'image/png' });

      const shareTitle = 'Hari Santri Nasional 2025';
      const shareText = `ðŸŒ¿âœ¨ Yuk rayakan momen istimewa ini bersama MDT Al-Ikhwan Margasari! 
Saya sudah pasang overlay foto, giliran kamu sekarang`;

      if (navigator.canShare && navigator.canShare({ files: [file] })) {
        try {
          await navigator.share({
            title: shareTitle,
            text: shareText,
            files: [file],
            url: 'https://mdt-alikhwann.github.io/hari-santri/',
          });
        } catch (err) {
          console.warn('Share dibatalkan:', err);
        }
      } else {
        const shareUrl = 'https://mdt-alikhwann.github.io/hari-santri/';
        const fallbackText = `${shareText}\n\n${shareUrl}`;
        if (navigator.share) {
          try {
            await navigator.share({
              title: shareTitle,
              text: fallbackText,
              url: shareUrl,
            });
          } catch (err) {
            console.warn('Share dibatalkan:', err);
          }
        } else {
          alert('Browser tidak mendukung fitur bagikan langsung. Silakan download manual.');
        }
      }
    });
  </script>
</body>
    </html>
